{% extends "base.html" %}

{% block title %}–ü–∞–Ω–µ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ - –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è AI-–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12 mb-4">
        <h2 class="text-white">
            <i class="bi bi-code-slash"></i> –ü–∞–Ω–µ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
        </h2>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-list-check text-primary" style="font-size: 2.5rem;"></i>
                <h4 class="mt-2">{{ stats.total_tests }}</h4>
                <p class="text-muted mb-0 small">–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-check-circle-fill text-success" style="font-size: 2.5rem;"></i>
                <h4 class="mt-2">{{ stats.passed_tests }}</h4>
                <p class="text-muted mb-0 small">–ü—Ä–æ–π–¥–µ–Ω–æ</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-x-circle-fill text-danger" style="font-size: 2.5rem;"></i>
                <h4 class="mt-2">{{ stats.failed_tests }}</h4>
                <p class="text-muted mb-0 small">–ü—Ä–æ–≤–∞–ª–µ–Ω–æ</p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-robot text-info" style="font-size: 2.5rem;"></i>
                <h4 class="mt-2">{{ stats.total_assistants }}</h4>
                <p class="text-muted mb-0 small">–ü–æ–º–æ—â–Ω–∏–∫–æ–≤</p>
            </div>
        </div>
    </div>
</div>

<!-- NLP –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-graph-up"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ NLP
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="text-center p-3">
                            <h3 class="text-primary">{{ nlp_stats.total_queries }}</h3>
                            <p class="text-muted mb-0">–í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center p-3">
                            <h3 class="text-success">{{ nlp_stats.high_confidence }}</h3>
                            <p class="text-muted mb-0">–í—ã—Å–æ–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (&gt;70%)</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center p-3">
                            <h3 class="text-info">{{ "%.1f"|format(nlp_stats.avg_confidence * 100) }}%</h3>
                            <p class="text-muted mb-0">–°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –¢–µ—Å—Ç—ã -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-bug"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞–º–∏
                </h5>
                <button class="btn btn-sm btn-light" data-bs-toggle="modal" data-bs-target="#createTestModal">
                    <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç
                </button>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–¢–∏–ø</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–°–æ–∑–¥–∞—Ç–µ–ª—å</th>
                                <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for test in tests %}
                            <tr>
                                <td>{{ test.id }}</td>
                                <td>
                                    <strong>{{ test.name }}</strong>
                                    {% if test.description %}
                                    <br><small class="text-muted">{{ test.description }}</small>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-secondary">{{ test.test_type }}</span>
                                </td>
                                <td>
                                    {% if test.status == 'passed' %}
                                        <span class="badge bg-success">
                                            <i class="bi bi-check-circle"></i> –ü—Ä–æ–π–¥–µ–Ω
                                        </span>
                                    {% elif test.status == 'failed' %}
                                        <span class="badge bg-danger">
                                            <i class="bi bi-x-circle"></i> –ü—Ä–æ–≤–∞–ª–µ–Ω
                                        </span>
                                    {% else %}
                                        <span class="badge bg-warning text-dark">
                                            <i class="bi bi-clock"></i> –û–∂–∏–¥–∞–µ—Ç
                                        </span>
                                    {% endif %}
                                </td>
                                <td>{{ test.creator_name }}</td>
                                <td>
                                    <small class="text-muted">{{ test.created_at }}</small>
                                </td>
                                <td>
                                    <a href="/developer/test/{{ test.id }}/run" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-play-circle"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ü–æ–º–æ—â–Ω–∏–∫–∏ -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-robot"></i> –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–º–æ—â–Ω–∏–∫–æ–≤
                </h5>
                <button class="btn btn-sm btn-light" data-bs-toggle="modal" data-bs-target="#createAssistantModal">
                    <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –ø–æ–º–æ—â–Ω–∏–∫–∞
                </button>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for assistant in assistants %}
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <div style="font-size: 3rem; color: {{ assistant.color }}">
                                    {{ assistant.icon }}
                                </div>
                                <h5 class="mt-2">{{ assistant.name }}</h5>
                                <p class="text-muted small">{{ assistant.description }}</p>
                                <span class="badge" style="background-color: {{ assistant.color }}">
                                    {{ assistant.specialty }}
                                </span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–∞ -->
<div class="modal fade" id="createTestModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-bug"></i> –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="/developer/create_test">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="form-control" name="description" rows="2"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–¢–∏–ø —Ç–µ—Å—Ç–∞</label>
                        <select class="form-select" name="test_type" required>
                            <option value="nlp">NLP —Ç–µ—Å—Ç</option>
                            <option value="integration">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π</option>
                            <option value="unit">–ú–æ–¥—É–ª—å–Ω—ã–π</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ö–æ–¥ —Ç–µ—Å—Ç–∞</label>
                        <textarea class="form-control font-monospace" name="code" rows="5" 
                                  placeholder="def test_example():&#10;    assert 1 + 1 == 2"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</label>
                        <textarea class="form-control" name="expected_output" rows="2"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–º–æ—â–Ω–∏–∫–∞ -->
<div class="modal fade" id="createAssistantModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-robot"></i> –°–æ–∑–¥–∞—Ç—å –ø–æ–º–æ—â–Ω–∏–∫–∞
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="/developer/assistant/create">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="form-control" name="description" rows="2"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è</label>
                        <input type="text" class="form-control" name="specialty" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–ò–∫–æ–Ω–∫–∞ (emoji)</label>
                        <input type="text" class="form-control" name="icon" value="ü§ñ" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">–¶–≤–µ—Ç</label>
                        <input type="color" class="form-control" name="color" value="#17a2b8" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}